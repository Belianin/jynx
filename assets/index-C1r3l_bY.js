(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();let O="/home/guest";function ie(n){O=n}function oe(n){const e=le(n),t=[];let s={args:[],redirects:[]},r=0;for(;r<e.length;){const i=e[r];if(i==="|"){if(s.args.length===0)throw new Error("Пустая команда перед |");t.push(s),s={args:[],redirects:[]},r++;continue}if(ce(i)){const{fd:o,type:l}=ae(i);if(r++,r>=e.length)throw new Error("Ожидается цель перенаправления после "+i);const c=e[r];s.redirects.push({fd:o,type:l,target:c}),r++;continue}s.args.push(i),r++}return(s.args.length>0||s.redirects.length>0)&&t.push(s),t}function le(n){const e=[];let t=0;const s=n.length;let r="",i=!1,o=!1;for(;t<s;){const l=n[t];if(i){l==="'"?(i=!1,t++):(r+=l,t++);continue}if(o){l==='"'?(o=!1,t++):(r+=l,t++);continue}if(l==="'"){i=!0,t++;continue}if(l==='"'){o=!0,t++;continue}if(/\s/.test(l)){r.length>0&&(e.push(r),r=""),t++;continue}if(l==="|"||l==="<"||l===">"){r.length>0&&(e.push(r),r=""),(l===">"||l==="<")&&n[t+1]===l?(e.push(l+l),t+=2):(l===">"||l==="<")&&n[t+1]==="&"?(e.push(l+"&"),t+=2):(e.push(l),t++);continue}if(/\d/.test(l)&&(n[t+1]===">"||n[t+1]==="<")){r.length>0&&(e.push(r),r=""),e.push(l+n[t+1]),t+=2;continue}r+=l,t++}return r.length>0&&e.push(r),e}function ce(n){return n===">"||n===">>"||n==="<"||n==="<<"||n===">&"||n==="<&"||/^\d[<>]$/.test(n)}function ae(n){if(/^\d[<>]$/.test(n))return{fd:Number(n[0]),type:n[1]};if(n===">"||n===">>")return{fd:1,type:n};if(n==="<"||n==="<<")return{fd:0,type:n};if(n===">&"||n==="<&")return{fd:1,type:n};throw new Error("Неизвестный тип перенаправления "+n)}function ue(n){const e={},t=[];let s=!0;for(let r=0;r<n.length;r++){const i=n[r];if(s){if(i==="--"){s=!1;continue}if(i.startsWith("--")){const[o,l]=i.slice(2).split("=");if(!/^[a-zA-Z0-9\-]+$/.test(o))throw new Error(`Недопустимое имя флага: --${o}`);if(l!==void 0)e[o]=l;else{const c=n[r+1];c!==void 0&&!c.startsWith("-")?(e[o]=c,r++):e[o]=!0}}else if(i.startsWith("-")&&i.length>1){const o=i.slice(1).split("");for(let l=0;l<o.length;l++){const c=o[l];if(!/^[a-zA-Z]$/.test(c))throw new Error(`Недопустимый короткий флаг: -${c}`);e[c]=!0}}else t.push(i)}else t.push(i)}return{flags:e,positional:t}}const he={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white"},Z={};for(let[n,e]of Object.entries(he))Z[e]=t=>`\x1B[${n}m${t}\x1B[0m`;const G=/\x1b\[([0-9;]*)m/g,z=n=>n.replace(G,""),fe=n=>{if(n==="")return[];let e=[],t=0,s;for(;(s=G.exec(n))!==null;){s.index>t&&e.push(n.slice(t,s.index));const r=s[1].split(";").filter(i=>i.length>0).map(i=>Number(i));r.length===0&&r.push(0),e.push(r),t=G.lastIndex}return t<n.length&&e.push(n.slice(t)),e},U={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white"},de=(n,e)=>{const t={...n};for(let s of e){if(s===0)return{};s===1?t.bold=!0:s===3?t.curly=!0:s===4?t.underline=!0:s>=30&&s<=37?t.color=U[s]:s==39?t.color=void 0:s>=40&&s<=47?t.backgroundColor=U[s]:s==49&&(t.backgroundColor=void 0)}return t};function q(n){const e=[];return n.color&&e.push(n.color),e}function me(n,e){const t=pe(n)?Array.from(n.classList):[];return t.length!==e.length?!1:(t.sort(),e.sort(),t.every((s,r)=>s===e[r]))}const pe=n=>n instanceof Element;class B{constructor(e){this.value="",this.cursorPos=0,this.terminal=e,this.startPos=e.getCursorPosition()}write(e){if(this.value===""||this.cursorPos===this.value.length){this.terminal.write(e);const t=z(e);this.value=this.value.substring(0,this.cursorPos)+t+this.value.substring(this.cursorPos),this.cursorPos+=t.length}else{this.terminal.write(e);const t=this.value.substring(this.cursorPos);this.terminal.write(t);const s=z(e);this.value=this.value.substring(0,this.cursorPos)+s+t,this.cursorPos+=s.length+t.length,this.moveCursor(-t.length)}console.log("$"+this.value+"$")}remove(){this.cursorPos!==0&&(this.cursorPos-=1,this.terminal.remove(),this.value=this.value.substring(0,this.cursorPos)+this.value.substring(this.cursorPos+1),console.log(this.value))}removeAfterCursorLine(){this.terminal.removeAfterCursorLine(),this.value=this.value.substring(0,this.cursorPos),console.log(this.value)}moveCursor(e){if(console.log(this.value),this.cursorPos+=e,this.cursorPos>this.value.length)return;this.cursorPos<0&&(this.cursorPos=0);let t=this.startPos.x+this.startPos.y*this.terminal.width;t+=this.cursorPos;const s=t%this.terminal.width,r=Math.floor(t/this.terminal.width);this.terminal.setCursorPosition(s,r)}moveCursorToStart(){console.log(this.value),this.terminal.setCursorPosition(this.startPos.x,this.startPos.y),this.cursorPos=0}moveCursorToEnd(){console.log(this.value),this.cursorPos=this.value.length;let e=this.startPos.x+this.startPos.y*this.terminal.width;e+=this.cursorPos;const t=e%this.terminal.width,s=Math.floor(e/this.terminal.width);this.terminal.setCursorPosition(t,s)}setCursor(e){console.log(this.value),this.cursorPos=e,this.cursorPos<0?this.cursorPos=0:this.cursorPos>this.value.length&&(this.cursorPos=this.value.length)}}const ge=async function*(n,e,{tryBindTerminal:t,fs:s,core:r,color:i,id:o}){const l=t();if(!l)throw new Error("Faield to bind terminal");const c=l,p=(()=>{const f=s.open(ee);if(!f||f.type!=="-")return[];var w=f.content.split(`
`);return Object.fromEntries(w.map(S=>S.split("=").filter($=>$.trim()!=="")))})(),d=()=>{const f={},w=p.PATH;if(!w)return f;const E=w.split(";").filter(S=>S.trim()!=="");console.log(E);for(let S of E){const v=s.open(S);if(!(!v||v.type!=="d"))for(let $ of v.children)"command"in $&&(f[$.name]=$.command)}return f},y=async f=>{if(f==="")return;const w=d(),E=oe(f),S=[];for(let{args:v,redirects:$}of E){const k=v[0],x=w[k];if(!x){c.write(`Command '${k}' not found
`);return}S.push({command:x,args:v.splice(1),redirects:$})}try{await C(S)}catch(v){v instanceof Error?c.write(v.message+`
`):c.write(`Internal problem
`)}},C=async f=>{const w=f.map(()=>ye()),E=(v,$)=>{const k=v.startsWith("/")?v:`${O}/${v}`;let x=s.open(k);if(x||(x=s.createFile(k)),!x||x.type!=="-")throw new Error(`${x} is not a file`);return $||(x.content=""),{write(K){x.content+=K},close:()=>{}}},S=f.map(({command:v,args:$,redirects:k},x)=>{let K=x===0?Y():w[x-1],F={write:D=>c.write(D)},L={write:D=>{c.write(D)}};const W=k.find(D=>D.fd===1),M=k.find(D=>D.fd===2);let X=!1;return W?F=E(W.target,W.type===">>"):x<f.length-1&&(F=w[x]),M&&(M.type===">&"&&M.target==="1"?X=!0:L=E(M.target,M.type===">>")),X&&(L=F),(async()=>{const D={...p,PWD:O};let J=()=>{};const ne=N=>{typeof N=="number"?("close"in F&&F.close(),"close"in L&&L.close(),J()):N.type==="stdout"?F.write(N.data):L.write(N.data)};return r.run(K,v,$,!W&&x===f.length-1,D,ne),new Promise(N=>J=N)})()});await Promise.all(S)},u=[];let a=0;const P=`${i.red("guest@localhost")}:${i.yellow("/home/guest")} `;c.write(P);function g(f){return a+=f,a<-1&&(a=-1),a===-1?"":(a>=u.length&&(a=u.length-1),u[u.length-a-1]||"")}let m=new B(c);const b=f=>{const w=g(f);m.moveCursorToStart(),m.removeAfterCursorLine(),m.write(w)};let T=!1;function I(f){if(!T){if(f.key.length===1&&!f.ctrlKey&&!f.metaKey)m.write(f.key);else if(f.ctrlKey&&f.key==="v")navigator.clipboard.readText().then(w=>m.write(w));else if(f.key==="Backspace")m.remove();else if(f.key==="Delete")m.remove();else if(f.key==="ArrowLeft")m.moveCursor(-1);else if(f.key==="ArrowRight")m.moveCursor(1);else if(f.key==="ArrowUp")b(1);else if(f.key==="ArrowDown")b(-1);else if(f.key==="Enter"){const w=m.value;m.moveCursorToEnd(),w!==""?(c.write(`
`),u.push(w),T=!0,y(w).then(E=>{c.write(P),m=new B(c),T=!1})):(c.write(`
${P}`),m=new B(c))}}}return c.onKey(o,I),await new Promise(f=>f),0};function ye(){const n=[];let e=null,t=!1;return{async*[Symbol.asyncIterator](){for(;;)if(n.length)yield n.shift();else{if(t)break;await new Promise(r=>e=r)}},write(r){n.push(r),e==null||e()},close(){t=!0,e&&e()}}}async function*Y(){}const H="/sys/bin",Q="/usr/bin",ee="/sys/etc/env",A=n=>({type:"stderr",data:n.endsWith(`
`)?n:n+`
`}),te=n=>({type:"stdout",data:n.endsWith(`
`)?n:n+`
`});class we{constructor(e,t){this.fs=e,this.processes={},this.lastProcessId=0,this.terminal=t}run(e,t,s,r,i,o){let l=++this.lastProcessId,c=()=>{};const h=new Promise(u=>{c=u}),p={id:l,command:t,workingDirectory:"/home/guest",closed:()=>h},d=u=>{const a=u.startsWith("/")?[""]:p.workingDirectory==="/"?[""]:p.workingDirectory.split("/");return u.split("/").forEach(P=>{P===".."?a.length>1&&a.pop():P!==""&&P!=="."&&a.push(P)}),a.join("/")||"/"};this.processes[l]=p;const y=t(e,s,{color:Z,isStdoutToConsole:r,core:this,fs:{open:u=>this.fs.find(d(u)),remove:u=>this.fs.remove(d(u)),createDirectory:u=>this.fs.makeDirectory(d(u)),createFile:u=>this.fs.makeFile(d(u)),getPathTo:d,changeWorkingDirectory:u=>{u=d(u);const a=this.fs.find(u);a&&(a.type==="d"||a.type==="r")&&ie(u)},makeSysFile:(u,a)=>this.fs.makeSysFile(d(u),a)},tryBindTerminal:this.bindTerminal.bind(this),parseArgs:ue,std:{out:te,err:A},variables:i,id:l,changeDirectory:u=>p.workingDirectory=u}),C=()=>{y.next().then(({done:u,value:a})=>{o==null||o(a),u?(delete this.processes[l],c()):C()})};return C(),p}bindTerminal(){return this.terminal.isOpen=!0,this.terminal.buffer="",this.terminal.closedTermialPromise=new Promise(e=>this.terminal.resolveСlosedTermialPromise=e),this.terminal}}const se="/sys/etc/apt/sources",Pe=`/public/repository
`,ve=async function*(n,e,{fs:t}){e[0];const s=e[1],r=t.open(se);if(!r)return yield A("No sources available"),1;const i=r.content.split(`
`).map(c=>c.trim()).filter(c=>c!==""),o=await xe(i,s);if(!o)return yield te(`Module ${s} not found`),1;const l=o.default;return t.makeSysFile(`/usr/bin/${s}`,l),0},xe=async(n,e)=>{for(let t of n){const s=await Ce(`${t}/${e}.js`);if(s)return s}return null},Ce=async n=>{try{return await import(n)}catch{return null}},re=n=>"content"in n,be=n=>"parent"in n||"children"in n,j=n=>"children"in n,Te=async function*(n,e,{std:{out:t},fs:{open:s}}){if(e.length===0)return 0;const r=e[0],i=s(r);if(!i)throw new Error(`File ${r} not found`);if(re(i))yield t(i.content);else throw new Error(`${r} is not a file`);return 0},$e=async function*(n,e,{fs:{changeWorkingDirectory:t}}){try{return t(e[0]),0}catch(s){yield A(s)}return 1},Se=async function*(n,e,{fs:t}){const s=e[0].startsWith("/")?e[0]:O+"/"+e[0],r=e[1].startsWith("/")?e[1]:O+"/"+e[1],i=t.open(s);if(!i||!("parent"in i))return yield A("Failed to copy"),1;if(r.endsWith("/")){const o=t.open(r.substring(0,r.length-1));if(!o||!("children"in o))return 1;if(o.children.find(c=>c.name===i.name))return yield A("Already exists"),1;const l={...i,created:new Date};l.parent=o,o.children.push(l)}else{const o=r.lastIndexOf("/");let l=r.substring(0,o);l===""&&(l="/");const c=t.open(l);if(!c||!("children"in c))return 1;const h=r.substring(o+1);if(c.children.find(d=>d.name===h))return yield A("Already exists"),1;const p={...i,name:h,created:new Date};p.parent=c,c.children.push(p)}return 0},Ee=async function*(e,t,{std:{out:s}}){return yield s(t==null?void 0:t.join(" ")),0},De=async function*(n,e,{std:{out:t},fs:{open:s,createFile:r},tryBindTerminal:i,color:o,id:l}){let c;if(e.length>0){const a=s(e[0]);if(a&&a.type!=="-")return 1;c=a}const h=i();if(!h)return 1;const p=h;let d=!1;p.clear();const y=new B(p);c&&p.write(c.content);let C=()=>{};const u=new Promise(a=>C=a);return p.onKey(l,a=>{a.key==="U"?(d=!d,d?y.write("\x1B[33m"):y.write("\x1B[39m")):a.key==="Escape"?(!c&&e.length>0&&(c=r(e[0])),c&&(c.content=y.value),p.close(l),C()):a.key==="ArrowRight"?y.moveCursor(1):a.key==="ArrowLeft"?y.moveCursor(-1):a.key==="Enter"?y.write(`
`):a.key.length===1&&!a.ctrlKey&&!a.metaKey&&y.write(a.key)}),await u,0},ke=async function*(n,e,{variables:t,std:{out:s}}){for(let[r,i]of Object.values(t))yield s(`${r}=${i}`);return 0},Fe="magenta",Ne=async function*(n,e,{parseArgs:t,std:{out:s,err:r},isStdoutToConsole:i,color:o}){const{positional:l,flags:c}=t(e),h=l.length>0?l[0]:"",p=c.color!=="false"&&(i||c.color);let d="";for await(const y of n){d+=y;let C;for(;(C=d.indexOf(`
`))!==-1;){const u=d.slice(0,C);if(h==="")yield s(u);else{const a=Ae(u,h);if(a.length!==0){let P="";for(let g=0;g<a.length;g++){const m=a[g],b=g===0?0:a[g-1]+h.length;P+=u.substring(b,m);const T=u.substring(m,m+h.length);P+=p?o[Fe](T):T}P+=u.substring(a[a.length-1]+h.length),yield s(P)}}d=d.slice(C+1)}}return d&&d.includes(h)&&(yield r(d)),0};function Ae(n,e){const t=[];let s=0;for(;s!==-1;)s=n.indexOf(e,s),s!==-1&&(t.push(s),s++);return t}const V="yellow",Oe=async function*(n,e,{parseArgs:t,std:{out:s},fs:{open:r},variables:{PWD:i,col:o},isStdoutToConsole:l,color:c}){const{flags:h,positional:p}=t(e),d=h.color!=="false"&&(l||h.color),y=p[0]||i,C=r(y);if(!C)return s(`${y} not found`),1;if(!be(C))return s(`${y} is not a folder`),1;const u=C.children.filter(a=>!a.name.startsWith(".")||h.a);if(h.l){const a=[0,0,0,0,0,0,0],P=[];for(let g of u){const m=[`${g.type}${g.permissions}`,"0",g.owner,g.ownerGroup,re(g)?g.content.length.toString():"0",Ie(g.created),g.name];for(let b=0;b<m.length;b++){const T=m[b].length;a[b]<T&&(a[b]=T)}P.push(m)}for(const[g,m]of P.map((b,T)=>[b,T])){const b=g.map((T,I)=>{const R=I!==0?T.padStart(a[I]+1):T;return d&&u[m].type==="-"&&I===g.length-1?c[V](R):R}).join("");yield s(b)}return 0}else return yield s(u.map(a=>a.type==="-"&&d?c[V](a.name):a.name).join("	")),0};function Ie(n){const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Date,s=e[n.getMonth()],r=n.getDate().toString().padStart(2," "),i=6*30*24*60*60*1e3;if(Math.abs(t.getTime()-n.getTime())<i){const o=n.getHours().toString().padStart(2,"0"),l=n.getMinutes().toString().padStart(2,"0");return`${s} ${r} ${o}:${l}`}else{const o=n.getFullYear();return`${s} ${r}  ${o}`}}const Le=async function*(n,e,{fs:{createDirectory:t}}){return t(e[0]),0},Me=async function*(n,e,{fs:{remove:t}}){return t(e[0]),0};class We{constructor(){this.root={children:[],name:"",permissions:"rw-rw-rw-",type:"r",created:new Date,owner:"guest",ownerGroup:"guest"},this.find=e=>{let t=this.root;if(e==="/")return t;const s=e.split("/").splice(1);for(let r=0;r<s.length-1;r++){const i=s[r],o=t.children.find(l=>l.name===i);if(o)if(j(o))t=o;else throw new Error(`${this.getPath(o)} is a file`);else throw new Error(`${this.getPath(t)}/${i} not extists`)}return t.children.find(r=>r.name===s[s.length-1])},this.findDirectory=e=>{let t=this.root;if(e==="/")return t;for(let s of e.split("/")){if(s==="")continue;const r=t.children.find(i=>i.name===s);if(r)if(j(r))t=r;else throw new Error(`${this.getPath(r)} is a file`);else throw new Error(`${this.getPath(t)}/${s} not extists`)}return t},this.remove=e=>{const t=this.find(e);t&&"parent"in t&&(t.parent.children=t.parent.children.filter(s=>s!==t))},this.makeDirectory=e=>{let t=this.root,s;for(let r of e.split("/")){if(r==="")continue;const i=t.children.find(o=>o.name===r);if(i)if(j(i))t=i;else throw new Error(`${this.getPath(i)} is a file`);else{const o={parent:t,children:[],name:r,permissions:"rw-r--r--",type:"d",created:new Date,owner:"guest",ownerGroup:"guest"};t.children.push(o),t=o,s=o}}return s},this.makeSysFile=(e,t)=>{let s=this.root;const r=e.split("/");for(let o=0;o<r.length-1;o++){const l=r[o];if(l==="")continue;const c=s.children.find(h=>h.name===l);if(c)if(j(c))s=c;else throw new Error("There is alread a file in a path");else{const h={parent:s,children:[],name:l,permissions:"rw-r--r--",type:"d",created:new Date,owner:"guest",ownerGroup:"guest"};s.children.push(h),s=h}}const i={parent:s,command:t,name:r[r.length-1],permissions:"rw-r--r--",type:"x",created:new Date,owner:"guest",ownerGroup:"guest"};s.children.push(i)},this.makeFile=(e,t)=>{let s=this.root;const r=e.split("/");for(let o=0;o<r.length-1;o++){const l=r[o];if(l==="")continue;const c=s.children.find(h=>h.name===l);if(c)if("children"in c)s=c;else throw new Error("There is alread a file in a path");else{const h={parent:s,children:[],name:l,permissions:"rw-r--r--",type:"d",created:new Date,owner:"guest",ownerGroup:"guest"};s.children.push(h),s=h}}const i={parent:s,content:t||"",name:r[r.length-1],permissions:"rw-r--r--",type:"-",created:new Date,owner:"guest",ownerGroup:"guest"};return s.children.push(i),i}}getPath(e){const t=[];for(t.push(e.name);"parent"in e;)e=e.parent,t.push(e.name);return t.reverse().join("/")}}class je{constructor(){this.files=[],this.folders=[],this.commands=[]}createFs(){const e=new We;for(let t of this.folders)e.makeDirectory(t);for(let[t,s]of this.files)e.makeFile(t,s);for(let[t,s]of this.commands)e.makeSysFile(`${H}/${t}`,s);return e}}const Be=()=>{const n=new je,e={echo:Ee,grep:Ne,cat:Te,mkdir:Le,ls:Oe,env:ke,cd:$e,rm:Me,cp:Se,apt:ve,edit:De};for(let t of Object.entries(e))n.commands.push(t);return n.files=[[ee,`PATH=${H};${Q}`],[se,Pe]],n.folders=[H,Q,O],n};class Re{constructor(e){this.isOpen=!1,this.buffer="",this.listeners={},this.closedTermialPromise=null,this.resolveСlosedTermialPromise=()=>{},this.parent=e,this.cursorPos={x:0,y:0},this.stylesStyle={},this.cursor=document.createElement("span"),this.cursor.classList.add("cursor"),this.cursor.textContent="█",e.appendChild(this.cursor),e.style.whiteSpace="pre",e.addEventListener("keydown",t=>{t.preventDefault();for(let s of Object.values(this.listeners))s(t)}),this.width=400,this.linPos=0}remove(){var t;let e=this.cursor.previousSibling;if(e){for(;((t=e.textContent)==null?void 0:t.length)===0;)if(e=e.previousSibling,e.remove(),e===null)return;e.textContent=e.textContent.substring(0,e.textContent.length-1),e.textContent===""&&e.remove(),this.linPos=this.linPos-1,this.cursorPos.x=this.linPos%this.width,this.cursorPos.y=Math.floor(this.linPos/this.width)}}removeAfterCursorLine(){let e=this.cursor.nextSibling;for(;e;)if(!e.textContent)e.remove(),e=e.nextSibling;else{const t=e.textContent.indexOf(`
`);if(t!==-1){e.textContent=e.textContent.substring(0,t);return}else e.remove(),e=e.nextSibling}}close(e){delete this.listeners[e]}getBuffer(){return this.buffer}_createStyledNode(){if(Object.keys(this.stylesStyle).length===0)return document.createTextNode("");const e=document.createElement("span"),t=q(this.stylesStyle);for(let s of t)e.classList.add(s);return e}write(e){const t=fe(e);for(let s of t)if(typeof s=="string"){let r=this.cursor.previousSibling;if(!r)r=this._createStyledNode(),this.parent.insertBefore(r,this.cursor);else{const l=q(this.stylesStyle);me(r,l)||(r=this._createStyledNode(),this.parent.insertBefore(r,this.cursor))}r.textContent=r.textContent+s;let i=s.length,o=this.cursor.nextSibling;for(;o&&i>0;){const l=o.textContent||"",c=Math.min(l.length,i),h=l.substring(c);o.textContent=h,i-=c,h.length===0&&o.remove(),o=o.nextSibling}this.linPos+=s.length,this.cursorPos.x=this.linPos%this.width,this.cursorPos.y=Math.floor(this.linPos/this.width),this.buffer+=s}else this.stylesStyle=de(this.stylesStyle,s)}onKey(e,t){this.listeners[e]=t,console.log(this.listeners)}closed(){if(!this.closedTermialPromise)throw new Error("Terminal not binded");return this.closedTermialPromise}clear(){this.parent.textContent="",this.parent.appendChild(this.cursor),this.linPos=0,this.cursorPos={x:0,y:0},this.buffer=""}setCursorPosition(e,t){this.cursorPos={x:e===void 0?this.cursorPos.x:e,y:t===void 0?this.cursorPos.y:t},this.linPos=this.cursorPos.x+this.cursorPos.y*this.width;const s=this.cursor.previousSibling,r=this.cursor.nextSibling;this.cursor.remove(),s&&r&&s.nodeType===Node.TEXT_NODE&&r.nodeType===Node.TEXT_NODE&&(s.textContent=(s.textContent||"")+(r.textContent||""),r.remove());let i=0;for(let o of this.parent.childNodes){const l=o.textContent||"";if(i+l.length>=this.linPos){const c=l.substring(0,this.linPos-i),h=l.substring(this.linPos-i);o.nodeType===Node.TEXT_NODE?(c!==""&&this.parent.insertBefore(document.createTextNode(c),o),this.parent.insertBefore(this.cursor,o),h!==""&&this.parent.insertBefore(document.createTextNode(h),o),o.remove()):(o.textContent="",c!==""&&o.appendChild(document.createTextNode(l.substring(0,this.linPos-i))),o.appendChild(this.cursor),h!==""&&o.appendChild(document.createTextNode(l.substring(this.linPos-i))));return}i+=l.length}}getCursorPosition(){return{...this.cursorPos}}}const _=document.getElementById("console");_.addEventListener("click",()=>_.focus());const Ke=Be(),Ge=Ke.createFs(),He=new we(Ge,new Re(_));He.run(Y(),ge,[],!0,{});
